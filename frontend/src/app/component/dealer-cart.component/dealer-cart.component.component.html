<div class="container my-4">
  <div class="card shadow-sm p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>ðŸ›’ Dealer Cart</h3>
      <div>
        <button class="btn btn-outline-secondary me-2" (click)="goToRequests()">My Requests</button>
        <button class="btn btn-danger" (click)="clearCart()">Clear Cart</button>
      </div>
    </div>

    <div *ngIf="!cart.length" class="text-center text-muted py-4">
      Your cart is empty. Add crops from the marketplace.
    </div>

    <div *ngIf="cart.length">
      <div *ngFor="let it of cart" class="cart-row mb-3">
        <!-- change this block inside *ngFor="let it of cart" -->
<div class="left">
  <img [src]="resolveImage(it.crop?.imageUrl)" alt="crop" (error)="onImageError($event)" />

</div>


        <div class="middle">
          <div class="title">{{ it.crop?.name }}</div>
          <div class="meta">Farmer: {{ it.crop?.farmerId || '-' }} â€¢ Available: {{ it.crop?.quantity || '-' }}</div>
        </div>

        <div class="right">
          <label>Qty</label>
          <div class="qty-controls">
            <button (click)="updateQty(it, -1)" class="btn-sm">-</button>
            <input type="number" [value]="it.quantity" (input)="setQty(it, $any($event.target).value)" />
            <button (click)="updateQty(it, 1)" class="btn-sm">+</button>
          </div>

          <label>Offer (â‚¹/unit)</label>
          <input type="number" [value]="it.offeredPrice" (input)="setPrice(it, $any($event.target).value)" />

          <div class="subtotal">Subtotal: â‚¹{{ (it.offeredPrice || 0) * (it.quantity || 0) }}</div>

          <div class="actions">
            <button class="btn btn-primary btn-sm" (click)="requestOne(it)" [disabled]="busy">Request</button>
            <button class="btn btn-outline-danger btn-sm" (click)="removeFromCart(it.id)" [disabled]="busy">Remove</button>
          </div>
        </div>
      </div>

      <div class="cart-summary mt-4 d-flex justify-content-between align-items-center">
        <div><strong>Total:</strong> â‚¹{{ getCartTotal() }}</div>

        <div>
          <button class="btn btn-success" (click)="requestAll()" [disabled]="busy">
            {{ busy ? 'Processingâ€¦' : 'Request All' }}
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="message" class="mt-3 alert alert-info">{{ message }}</div>
  </div>
</div>
